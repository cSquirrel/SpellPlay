#!/bin/bash
# SwiftFormat Pre-commit Hook
# Install: cp scripts/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

set -e

# Find SwiftFormat
if command -v swiftformat &> /dev/null; then
    SWIFTFORMAT="swiftformat"
elif [ -f "/opt/homebrew/bin/swiftformat" ]; then
    SWIFTFORMAT="/opt/homebrew/bin/swiftformat"
elif [ -f "/usr/local/bin/swiftformat" ]; then
    SWIFTFORMAT="/usr/local/bin/swiftformat"
else
    echo "‚ö†Ô∏è  SwiftFormat not found. Skipping pre-commit formatting."
    echo "   Install via: brew install swiftformat"
    exit 0
fi

# Get staged Swift files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=d | grep '\.swift$' || true)

if [ -z "$STAGED_FILES" ]; then
    exit 0
fi

echo "üîß Formatting staged Swift files..."

# Format each staged file
echo "$STAGED_FILES" | while read -r file; do
    if [ -f "$file" ]; then
        "$SWIFTFORMAT" "$file" --config .swiftformat --quiet
        git add "$file"
    fi
done

echo "‚úÖ SwiftFormat pre-commit complete"

